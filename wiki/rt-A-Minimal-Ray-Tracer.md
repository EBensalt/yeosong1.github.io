# 미니멀 레이 트레이서: Rendering Simple Shapes (Sphere, Cube, Disk, Plane, etc.)

Contents
- [Parametric and Implicit Surfaces](rt-A-Minimal-Ray-Tracer)
- [광선-구 교차](rt-광선-구-교차)
- [미니멀 레이 트레이서: 렌더링 영역](rt-미니멀레이트레이서)
- Ray-Plane과 Ray-Disk 교차
- Ray-Box 교차
- 소스 코드

*Keywords: ray-tracing, geometry, sphere, plane, disk, cube, parametric surface, implicit surface, ray-geometry intersection. 레이 트레이싱, 기하학, 구, 평면, 원판, 정육면체, 파라메트릭 표면, 임플리시트 표면, 광선-기하 교차*.

## 소개
이전 레슨에서는 primary rays를 생성하는 방법을 배웠지만 아직 이미지를 생성할 수는 없었습니다.
왜냐면 primary rays와 기하(어떤 종류든)의 교차를 계산하는 법을 안배웠기 때문입니다.
이번 레슨에서는 구처럼 간단한 모양의 기하로 광선-기하 교차 계산에 대해 알아 봅니다.
구체는 광선 추적 하기가 쉽기 때문에 레이 트레이서를 프로그래밍하는 방법을 배우는 사람들이 자주 사용합니다.
이 수업은 주제가 약간 일치하지 않습니다:

- 1 장(이번 장)에서는 parametric 표면과 implicit 표면에 대해 알아 봅니다. 이러한 표면이나 모양은 수학적으로 정의될 수 있다는 점에서 특별합니다. 이것은 다음 장에서 광선에 대한 교차점을 계산하기 위해 공부할 기술의 기초입니다.
- 2 장에서는 광선과 구의 교차점을 계산하는 몇 가지 기술에 대해 알아 봅니다.
- 3 장에서는 우리가 앞 레슨에서 배운 primary rays 생성, primary rays가 장면을 구성하는 구와 교차하는지 계산하기 위해 이 레슨의 2장에서 배운 내용을 함께 정리합니다. 이 레슨을 위해 개발할 프로그램은 최소한이지만 기능적인 레이 트레이서의 기초를 형성합니다. `trace()` 함수에 대해 배웁니다. 여기서 우리는 primary rays에 대해 각 구를 테스트하고 교차 거리와 가장 가까운 교차 구에 대한 포인터를 반환합니다 (선이 구와 전혀 교차하지 않은 경우). `castRay()` 함수에서 교차점에서 법선 좌표와 텍스처 좌표를 사용하여 간단한 음영 처리 방법을 배웁니다.
- 마지막으로 4 장과 5 장에서는 평면, 디스크, axis aligned boxes처럼 다른 간단한 모양으로 광선의 교차점을 계산하는 다양한 기술에 대해 학습합니다.
- 평소와 같이 이 단원의 마지막 장에는 예제 프로그램의 전체 소스 코드가 포함되어 있습니다.

## 광선-기하 교차
이전 레슨에서는 primary rays를 생성하는 방법을 배웠습니다.
이미지를 생성하려면 이제 광선-기하 교차에 대해 배워야합니다.
수학을 사용하여 광선이 물체와 교차하는지 확인하는 것이 핵심입니다.
이전 레슨에서 자주 언급했듯이 CG에서는 기하 또는 3D 객체를 다양한 방법으로 설명 할 수 있습니다.
우리는 다각형 메쉬 (면으로 만들어 짐), NURSB 표면, 서브디비젼 표면 등을 이미 언급했지만 폴리곤 메시의 하위 집합인 삼각형 메시와는 별도로 NURBS와 서브 디비젼 표면이 무엇인지 아직 공부하지 않았습니다.

이러한 유형의 형상이 컴퓨터 그래픽에 유용한 이유는 복잡한 객체의 모양을 잘 설명하기 때문입니다.
구, 평면, 디스크나 상자 같은 간단한 모양을 훨씬 간단한 방법으로 직접 렌더링 할 수 있습니다.
이러한 모양들은 방정식을 통해 실제로 수학적으로 서술될 수 있으며, 이 방정식으로 모양들이 광선에 교차되는지 여부를 분석적으로 계산할 수 있습니다.
이것이 우리가 이번 레슨에서 배울 것입니다.

도형을 수학적으로 어떻게 정의 할 수 있습니까? 실제로는 일반적으로 두 가지 다른 방식으로 수행 할 수 있습니다:
1.**parametrically**, 2.**implicitly**.

## Parametric Surfaces

![impsurf-ray](https://user-images.githubusercontent.com/53321189/87055557-77641f80-c23f-11ea-8588-20d5e99b653f.png)

~~~
그림 1: 광선의 파라메트릭 정의
~~~

이전 단원에서 말한 내용을 기억하면 다음 [parametric equation](https://en.wikipedia.org/wiki/Parametric_equation)매개변수 방정식을 사용하여 광선도 정의 할 수 있습니다:

<img width="105" alt="스크린샷 2020-07-09 오후 11 54 18" src="https://user-images.githubusercontent.com/53321189/87055613-89de5900-c23f-11ea-9615-6b8555eb12af.png">

P는 ray인 반선 위의 점이며, O는 ray origin이고 D는 ray direction입니다. t를 매개변수라고 합니다. t의 값을 변경함으로써 우리는 원하는만큼 광선ray 반선상의 많은 점을 묘사 할 수 있으며 이 점들의 집합은 반선 자체를 형성합니다. 즉, 광선을 따라 순서가 지정된 점 시퀀스를 생성하는 방법을 설명합니다. 구도 파라메트릭 형식을 사용해서 정의 할 수 있습니다. 구의 파라메트릭 방정식은 다음과 같습니다:

<img width="169" alt="스크린샷 2020-07-09 오후 11 56 39" src="https://user-images.githubusercontent.com/53321189/87055895-dde93d80-c23f-11ea-89c7-d7d02b46b6a1.png">

~~~
구면 좌표 spherical coordinates에서 직교 좌표Cartesian coordinates를 계산하는 방정식은 소스마다 다를 수 있습니다.
좌표계 축의 이름을 지정하는 데 사용되는 규칙과 θ가 극각 또는 방위각을 정의하는지 여부에 따라 다릅니다.
위의 예에서 y는 위쪽 축이며 x는 오른쪽을 가리키고 z는 y와 직교하는 평면에 있습니다.
θ는 그림 2와 같이 극각을 정의합니다.
~~~

또는 :

<img width="303" alt="스크린샷 2020-07-10 오전 12 35 30" src="https://user-images.githubusercontent.com/53321189/87060326-5a324f80-c245-11ea-9775-ad3bdf661729.png">

![impsurf-sphere](https://user-images.githubusercontent.com/53321189/87060452-83eb7680-c245-11ea-81c2-84990a2c5d05.png)

여기서 θ와 ϕ는 라디안([호도법](각도법과-호도법))으로 정의된 구에서 점의 위도 및 경도 좌표입니다.
각도 θ(그리스 문자 쎄타)는 [0, π] 범위에 포함되고 각도 ϕ(그리스 문자 파이)는 [0, 2π] 범위에 포함됩니다.
우리는 이미 [기하학](https://www.scratchapixel.com/lessons/mathematics-physics-for-computer-graphics/geometry/spherical-coordinates-and-trigonometric-functions)에 관한 수업에서 이 방정식을 소개했습니다.
구 위의 한 점의 좌표 θ, ϕ는 구면 좌표([spherical coordinates](https://en.wikipedia.org/wiki/Spherical_coordinate_system))라고도 합니다.
여기서 중요한 것은 구는 세 개의 방정식 세트를 사용하여 설명 할 수 있다는 것입니다.
이 파라메트릭 방정식에서 θ 및 ϕ는 매개 변수입니다.
이러한 방정식을 사용하여 정의 할 수 있는 3D 객체를 파라메트릭 표면[**parametric surfaces**](https://en.wikipedia.org/wiki/Parametric_surface)이라고 합니다.




-----------------------------
하는 중.............




CG에서 이 표현은 유용한데, 두 개의 파라미터 θ와 ϕ(일반적인 경우, 종종 u와 v 또는 s와 t로 표시 됨)는 물체의 3D 표면에 있는 점의 텍스처 좌표로 사용될 수 있기 때문입니다. 

구의 경우 두 매개 변수 θ와 ϕ를 [0, 1] 범위로 쉽게 리매핑
이러한 좌표를 사용하여 텍스처에서 조회를 수행하거나 절차적 접근 방식을 사용하여 패턴을 생성 할 수 있습니다. 이 기술의 예는 이 단원에서 제공됩니다 ([3 장](rt-미니멀-레이-트레이서)). 다시 말해, 프로세스는 2D 공간에서 3D 공간으로의 일종의 매핑으로 볼 수 있습니다 (그리고 우리는 텍스처링을 위해 2D 좌표를 st 좌표로 사용합니다).

일반적으로 파라메트릭 표면에 대해 기억해야 하는 것은 곡선을 설명하기 위해 1 개의 매개 변수와 3D 표면을 설명하기 위해 2 개의 매개 변수가 필요하다는 것입니다.

## Implicit Surfaces

(암시적 표면?)

![impsurf-circle](https://user-images.githubusercontent.com/53321189/87067355-e72dd680-c24e-11ea-8f80-3e4ced2e59a1.png)

어떤 방식으로 Implicit Surfaces은 파라메트릭 표면과 매우 유사합니다. 우선, 우리는 Implicit 형식으로 다음 방정식으로 정의되는 원의 예를 사용합니다:

<img width="123" alt="스크린샷 2020-07-10 오전 1 43 54" src="https://user-images.githubusercontent.com/53321189/87067316-da10e780-c24e-11ea-8b83-b4ef93b6d659.png">

여기서 x와 y는 2D 공간에서 점의 좌표이고 r은 원의 반지름입니다 (그림 1). 반경 r의 원에있는 모든 점에 대해 위의 방정식이 참이라는 것입니다. 즉, 원 또는 반지름 r에 있는 점의 좌표를 가져 와서 이 좌표를 2의 거듭 제곱으로 올린 다음 합하면 원의 반지름과 같은 수를 얻습니다. 이 예에서 원은 원점을 중심으로 하는 것으로 가정합니다. 이 방정식을 임의의 중심 위치를 가진 원으로 일반화 할 수 있지만 :

<img width="212" alt="스크린샷 2020-07-10 오전 1 45 23" src="https://user-images.githubusercontent.com/53321189/87067475-0d537680-c24f-11ea-8380-8538c030377f.png">

여기서 O는 원 중심 위치입니다. 그러나 이 모든 방정식은 원의 중심을 원점으로 "이동"하는 것입니다. 위의 방정식은 원의 Implicit 방정식입니다. 이 개념은 3D로 쉽게 확장될 수 있습니다. 구의 Implicit 방정식은 다음과 같습니다.

<img width="151" alt="스크린샷 2020-07-10 오전 1 45 59" src="https://user-images.githubusercontent.com/53321189/87067516-24926400-c24f-11ea-85f3-f2b478b3a5d2.png">

개념은 정확히 같습니다. 반지름 r의 구면에있는 모든 점에 대해 방정식이 적용됩니다.

이 레슨에서는 이러한 방정식을 사용하여 Implicit 표면과 광선의 교차점을 테스트하는 방법에 대해 알아 봅니다.

![impsurf-bounding-sphere](https://user-images.githubusercontent.com/53321189/87067687-5efc0100-c24f-11ea-9da8-792c1b0bbc66.png)

~~~
그림 4 : 구를 경계 볼륨으로 사용하여 광선이 닫힌 형상과 교차하는지 테스트합니다.
광선이 구와 교차하지 않으면 물체와 교차 할 수 없다는 것을 알 수 있습니다.
~~~

평면, 구, 원뿔, 원환 체 등과 같은 방정식으로 많은 모양을 정의 할 수 있습니다. 이러한 모양은 복잡한 물체의 모양을 설명하는 데 매우 유용하지 않다고 생각할 수도 있습니다. 이것이 우리가 이 강의를 소개 할 때 말한 것입니다. 렌더링 영역은 프로그램을 테스트하는 데 유용하지만 실제로 제한적입니다. 그러나 다른 상황에서는 유용 할 수 있습니다. 예를 들어 구를 사용하여 객체의 전체 부피를 경계 부피로 나타낼 수 있습니다 (그림 4). 동봉 된 객체가 매우 복잡한 경우 광선이 이 객체와 교차하는지 테스트하면 계산 비용이 많이 듭니다. 먼저 할 수 있는 것은 광선이 경계 영역과 교차하는지 확인하는 것입니다. 그렇지 않으면 광선이 닫힌 개체와 교차 할 수 없다는 것을 확실히 알기 때문에 개체 자체와의 교차점을 테스트하는 데 걸리는 시간이 절약됩니다. 이 방법은 물론 광선-구 교차점을 계산하는 데 걸리는 시간이 동봉된 객체와 광선의 교차점을 계산하는 데 걸리는 시간보다 훨씬 큰 경우에만 유리합니다. 좋은 소식은 광선과 Implicit 표면 사이의 교차점 테스트 비용이 예를 들어 종종 광선-삼각 교차점 테스트보다 적다는 것입니다. 장면에 복잡한 객체가 많이 포함 된 경우이 간단한 광선 형상 가속 방법을 사용하면 이미 많은 계산 시간을 절약 할 수 있습니다. 결론적으로, Implicit 표면에 대한 학습과 광선-기하 교차를 계산하는 데 사용되는 방법은 모양이 단순함에도 여전히 유용합니다.

---------

![blobbies](https://user-images.githubusercontent.com/53321189/87067811-84890a80-c24f-11ea-845d-e67a73bed7d6.png)

~~~
Implicit 표면 및 Blobies : Implicit 표면의 한 클래스는 매우 흥미롭습니다. 그들은 CG literature에서 많은 이름으로 불린다 : blobies, metaballs, 등등. 당신은 blobies가 서로에게 영향을 미치는 작은 구로 볼 수 있습니다. 두 개의 blobie가 서로 가까이 있을 수 있으면 표면이 가운데에서 혼합되어 더 큰 얼룩을 형성합니다. Blobies는 1980-1990 년대에 매우 인기있는 모델링 기술이었습니다. 그들은 유기적인 모양을 모델링하는 데 매우 좋습니다. Blobies는 쉽게 광선 추적 할 수 없습니다. 그들은 종종 다각형 메쉬로 먼저 변환해야합니다. blobie에 대한 레슨은 모델링 섹션에서 찾을 수 있습니다.
~~~

## 왜 이런 surface들이 레이 트레이싱에 유용한가

이 학습의 주제는 방정식으로 정의되는 특성을 사용하여 광선-기하 교차 테스트를 계산하는 방법을 연구하는 것입니다. 파라메트릭 표면은 이 광선-기하 교차 테스트를 계산하는 데 Implicit 표면보다 유용하지 않지만, 다음 장에서 설명하는 것처럼 Implicit 객체의 표면에 있는 점의 텍스처 좌표를 계산하는 데 유용합니다. 따라서 두 표현에 대해 아는 것이 여전히 유용하고 필요합니다. 위에서 언급한 이유로 유용합니다.

- 광선-Implicit 표면에 대한 솔루션은 다른 유형의 형상보다 계산이 더 간단합니다.
- Implicit 표면과 광선의 교차는 종종 다른 기하 유형보다 계산 속도가 더 빠릅니다.
- 모양은 복잡한 물체의 모양을 나타내기에는 너무 단순하지만, 예를 들어 광선-기하 교차 테스트를 가속화 하는 데 사용할 수 있는 경계 볼륨으로 사용될 수 있습니다.
- 광선-Implicit 표면 교차 테스트는 2차방정식의 근을 계산하는 것과 같은 수학적 개념을 실제로 사용하는 예입니다.

이 단원에서는 광선 구면, 광선 평면, 광선 디스크 (광선 케이스의 적용) 및 광선 상자 교차 테스트에 대해 알아 봅니다. 구는 2차라고 하는 표면 범주에 속합니다. 구에 대해 설명할 솔루션과 동일한 솔루션을 사용하여 광선에 대해 모든 2차 (콘, 원환 등)를 테스트 할 수 있습니다.

## 통합 및 미분 : 도함수, 탄젠트 및 법선 벡터

파라메트릭 또는 Implicit 표면을 사용하는 또 다른 이점은 이러한 표면의 모양을 정의하는 방정식을 사용하여 표면의 특정 지점에서 도함수, 탄젠트, 2 탄젠트 및 법선과 같은 다른 유용한 값을 계산할 수 있습니다. 우리는 이미 노멀과 쉐이딩에서 그들이하는 역할에 대해 이미 알고 있습니다. 점의 표면에있는 미분은 텍스처 필터링과 같은 것들에도 중요합니다. 탄젠트와 바이 탄젠트를 사용하여 음영 처리에 유용한 물체 표면의 특정 지점에 로컬 좌표계를 형성 할 수도 있습니다. 이 값을 계산하는 데 관련된 수학은 암시 적 표면과 광선의 교차점을 계산하는 데 사용되는 수학보다 훨씬 더 복잡 할 수 있으며이 단원에서는 연구하지 않습니다. 이 주제에 관심이있는 경우 웹에서 차등 형상을 검색 할 수 있습니다. 이 주제에 대해서만 별도의 강의가 제공됩니다. 다음 단원에서는 법선을 사용하지만 구 및 삼각형과 같은 모양의 경우 차등 형상의 기법을 사용하는 것보다 법선을 계산하는 간단한 방법입니다.

## About Ray-Tracing Spheres and Writing a Production Quality Ray-Tracer

이 단원에서 구체와 광선의 교차점을 계산하는 방법은 다음 단원에서 광선 삼각 교차점을 계산하는 방법과 다릅니다. 이전 레슨에서 언급했듯이 일반적으로 여러 가지 이유로 렌더러에서 여러 유형의 지오메트리를 지원하지 않아도됩니다. 먼저 더 많은 코드를 작성해야하지만 더 중요한 것은 프로그램에서 지원하는 모든 기능 (모션 블러, 변위, 텍스처 매핑, 가속 구조 등)이 지원되는 각 지오메트리 유형과 함께 작동해야하므로 프로그래머에게 추가적인 제약을 가하기 때문입니다. 따라서 일반적으로 하나의 지오메트리 유형 (삼각형이 가장 일반적으로 선택됨) 만 지원하고 다른 지오메트리 유형을 해당 유형으로 변환하는 것이 더 쉽습니다. 대부분의 프로덕션 렌더러는 구, 토리 등의 간단한 모양을 렌더링하는 방법을 제공합니다. 내부적으로 처리하는 방식은 광선-기하학적 교차 루틴을 구현하는 대신 이러한 모양을 다각형 메쉬로 변환하는 것입니다 (일반적으로 이러한 모양의 파라 메트릭 표현 사용). 구체와 토리에만 해당됩니다 (레이 트레이싱 : 메쉬 렌더링 [링크] 단원에서 파라 메트릭 표면을 다각형 메쉬로 변환하는 방법에 대해 알아 봅니다). 실제로 생산 환경에서는 구를 거의 렌더링하지 않습니다. 이것이 우리가이 수업에서 사용할 접근법은 아니지만. 우리는 구식을 사용하거나 이러한 모양을 광선 추적하는 기본 방식과 다르게 말할 것입니다. 물론,이 단원에서 배울 방법의 장점은 다각형 메쉬로 변환 할 필요가없고 방정식을 사용하여 구를 렌더링하는 것이 100, 1.000 또는 그로 구성된 구를 광선 추적하는 것보다 훨씬 빠르다는 것입니다. 10.000 개의 삼각형. 구체 또는 2 차 표면을 레이트 레이싱하는 방법을 배우는 것은 연습으로 좋지만 실제로는 일반적으로 프로덕션 품질 렌더러에서 수행되는 방식이 아닙니다.

------------------------
Chapter 1 of 6         [다음 장 ->](rt-광선-구-교차)
