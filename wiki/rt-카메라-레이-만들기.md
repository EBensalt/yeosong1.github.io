Contents
- [레이 정의 하기](rt-레이-정의-하기)
- [카메라 레이 만들기](#카메라-레이-만들기)
- [표준 좌표계](rt-표준좌표계)
- [소스 코드](rt-소스코드)

# 카메라 레이 만들기

1. 렌더러의 목표가 프레임의 각 픽셀에 색을 할당하는 것임을 기억해봅시다.
결과물은, 특정한 3D 관점에서 보았을 때 장면의 형상을 정확하게 표현해야 합니다.
2. FOV(화각)같은 매개변수에 따라 보이는 장면의 양이 바뀐다는 것도 이전 장에서 봐서 알고 있습니다.
3. 프레임의 각 픽셀에 대해 하나의 광선을 생성하여 레이 트레이싱한 이미지가 생성된다는 것도 레슨 1과 이번 레슨에서 설명했습니다. 
장면에서 광선이 물체와 교차할 때 그 교차점에서 물체의 색으로 픽셀의 색을 설정한다. 우리가 이미 레슨 1에서 얘기했던.. 하지만 다음 레슨에서 좀 더 자세하게 다시 설명할 이 프로세스는, **backward-tracing 역추적** 또는 **eye-tracing**이라고 부릅니다. (빛의 경로를 광원->물체->카메라가 아니라, 카메라->물체->광원으로 따라가기 때문이다)



![campixel](https://user-images.githubusercontent.com/53321189/85225141-fcf76b00-b409-11ea-88d3-6291612b2d4a.gif)
<br>그림 1 : backward-tracing 역추적 또는 eye-tracing은 눈에서 이미지의 각 픽셀 중심을 통과하는 추적 광선으로 구성됩니다. 광선이 장면에서 객체와 교차하는 경우 광선이 통과하는 픽셀의 색상은 이 교차점에서 객체의 색상으로 설정됩니다.


자연스럽게 이미지 생성 프로세스는 primary rays, camera rays라고 부르는 이 광선을 구성하는 것으로 시작합니다. 
(primary 왜냐면 이것들이 우리가 장면에 쏘는 첫 광선들이니까. secondary는 예를 들어 그림자 광선으로 나중에 이야기할 것입니다..)(같은 얘기 반복이 많네요.......) 
광선 구성을 도와줄.. 이 광선들에 대해서 우리는 뭘 알고 있죠?
이 광선들이 카메라 원점origin에서 시작한다는 것을 알고 있습니다.
거의 모든 3D 어플리케이션에서, 카메라를 만들 때 카메라의 기본 위치를 세계의 원점origin(좌표 (0, 0, 0))으로 정의합니다.
[3D Viewing: the Pinhole Camera Model](https://www.scratchapixel.com/lessons/3d-basic-rendering/3d-viewing-pinhole-camera) 레슨을 기억해보세요. 카메라의 원점은 핀홀 카메라의 조리개(조리개이자 투사projection하는 중심)로 볼 수 있습니다. 
실제 핀홀 카메라의 필름은 조리개 뒤에 있어서 기하학적 구조에 의해 광선이 장면의 역상을 형성합니다. 그러나 필름면이 장면과 같은 면에 있는 경우, (조리개 뒤가 아니라 조리개 앞) 이 반전을 피할 수 있습니다. 관례적으로 ray tracing에서는 카메라 원점에서 정확히 1 단위 떨어진 곳에 배치하는 경우도 왕왕 있습니다(이 거리는 절대 바뀌지 않습니다. 왜 그런지 저 밑에서 설명할 것입니다).
또 관례적으로, 카메라는 음의 z축을 따라 방향을 조정합니다(카메라 기본 방향은 개발자의 선택에 달려 있지만, 일반적으로 카메라는 양 또는 음의 z축을 따라 방향이 지정됩니다. RenderMan, Maya, PBRT 및 OpenGL은 카메라를 음의 z축을 따라 정렬하므로, 동일한 규칙을 따르는 편을 개발자에게 제안하고 싶습니다). 마지막으로, 증명을 단순화하기 위해 렌더링된 이미지는 square(이미지의 너비와 높이가 픽셀 단위에서 똑같은 square)인 것으로 가정하겠습니다.

![cambasic](https://user-images.githubusercontent.com/53321189/85225229-860ea200-b40a-11ea-865b-f71613779406.png)
<br> 그림 2 : 왼쪽 : 기본 카메라. 원래 이미지 크기는 6x6 픽셀이며 눈의 기본 위치는 세계의 중심 (0, 0, 0)입니다. 카메라가 음의 z축을 따라 어떻게 가리키는지 확인하십시오. 이미지 평면은 원점에서 정확히 1 단위 떨어져 있습니다. 오른쪽 : y축 왼쪽과 x축 아래의 픽셀은 음의 world space 좌표를 갖습니다.

우리의 작업은 프레임 안의 각 픽셀에 대한 primary rays를 만드는 것으로 구성됩니다. 이는 카메라 원점에서 시작해서 각 픽셀의 가운데를 통과하는 선을 추적해서 쉽게 수행 할 수 있습니다 (그림 1). 이 선을 <origin은 카메라의 원점origin이고, direction은 카메라의 원점부터 픽셀 중심까지의 벡터인 광선>의 형태로 표현할 수 있습니다. 픽셀 중앙의 점의 위치를 계산하기 위해서, 원래 **raster space**(점 좌표는 좌표(0,0)가 프레임의 왼쪽 상단 모서리 인 픽셀로 표시됩니다)로 표현되었던 픽셀 좌표를 **world space**로 변환하는 작업이 필요합니다.


![raydisk](https://user-images.githubusercontent.com/53321189/85227091-12729200-b416-11ea-8af7-8fb7b6ce1113.png)
<br>그림 3 : 레이-디스크 교차

왜 world space인가? world space는 기본적으로 장면의 모든 객체, 기하, 빛 및 카메라의 좌표가 표현되는 공간입니다. 
예를 들어, 디스크 형태가 음의 z축을 따라 월드 원점에서 5 단위 떨어져있는 경우, 디스크의 world space 좌표는 (0, 0, -5)입니다.
우리가 이 디스크와 광선의 교차점을 계산하기 위해 수학을 사용하고 싶다면, 광선의 원점과 방향도 같은 공간에서 정의되어야 합니다.
예를 들어, 광선의 원점(0, 0, 0)과 방향direction(0, 0, -1)이 있고, 이 숫자가 world space 좌표계의 좌표를 나타내는 경우,
광선은 (0, 0,- 5)에서 교차합니다. 이 내용이 그림 3에 나와 있습니다.

space 관련 정보는 [Computing the Pixel Coordinates of a 3D point](https://www.scratchapixel.com/lessons/3d-basic-rendering/computing-pixel-coordinates-of-3d-point)레슨에서 더 찾아보실 수 있습니다.

![rastertoworld](https://user-images.githubusercontent.com/53321189/85227427-61212b80-b418-11ea-98e5-5f822adf997f.gif)<br>그림 4 : 래스터에서 화면 공간으로

우리가 해결하려는 문제를 보는 또 다른 방법은 카메라에서 시작하는 것입니다. 이미지 평면이 world space의 원점에서 정확히 1 단위(1 유닛) 떨어진 곳에 위치하고, 음의 z축을 따라 정렬되어 있음을 우리는 알고 있습니다. 

또한 이미지가 정사각형이므로, 이미지가 투영되는 이미지 평면의 일부도 필연적으로 정사각형임을 알고 있어요. 앞으로 설명 할 이유 때문에, 이 projection 영역의 크기는 2 x 2 단위입니다 (그림 2). 또한 래스터 이미지가 픽셀로 구성되어 있음을 알고 있습니다. 우리가 필요로 하는 것은, raster space에서 이들 픽셀의 좌표와 동일한 픽셀의 좌표 사이에서 world space로 표현되는 관계를 찾는 것입니다. 이 프로세스에는 그림 5에 표시된 몇 가지 단계가 필요합니다.


![cambasic1A](https://user-images.githubusercontent.com/53321189/85227454-93cb2400-b418-11ea-8254-93f2b75d723d.png)
~~~
그림 5 : 픽셀 중간에 있는 점의 좌표를 표준 좌표로 변환하려면 몇 단계가 필요합니다.
이 점의 좌표는 먼저 raster space(픽셀 좌표에 오프셋 0.5를 더한 값)을 표시 한 다음,
NDC space로 변환(좌표를 [0,1]범위로 리매핑)한 다음,
화면 공간으로(NDC 좌표를 [-1,1]범위로 리매핑)변환합니다.
최종 카메라-->world 변환 4x4 매트릭스를 적용하면
화면 공간의 좌표가 world space로 변환됩니다.
~~~

우리는 첫째로, 프레임의 치수(??dimensions)로 픽셀 위치를 정규화 시켜야 합니다.
픽셀들의 정규화 된 새 좌표 = NDC space에 




# 요약: 우리는 첫 번째 이미지를 렌더링 할 준비가 거의 다 되었습니다.



------------------------
[<- 이전 장](rt-레이-정의-하기)        Chapter 2 of 4         [다음 장 ->](rt-표준좌표계)
